<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.proj.pots.main.dao.IPartyPageDAO">
	<select id="videoProc" resultType="PartyListDTO">
		SELECT a.* , b.party_count AS party_now_member , DATE_FORMAT(party_end, '%y.%m.%d') AS party_end_form
		FROM 
			party a 
		LEFT JOIN 
			(SELECT party_num, count(*) AS party_count FROM party_member GROUP BY party_num) 
			b 
		ON a.party_num = b.party_num WHERE party_service = #{sub} AND a.party_end >= NOW()
        ORDER BY party_regdate DESC;
	</select>
	
	<select id="listCount" resultType="int">
		SELECT a.* , b.party_count AS party_now_member , DATE_FORMAT(party_end, '%y.%m.%d') AS party_end_form
		FROM 
			party a 
		LEFT JOIN 
			(SELECT party_num, count(*) AS party_count FROM party_member GROUP BY party_num) 
			b 
		ON a.party_num = b.party_num WHERE party_service = 10 AND a.party_end >= NOW()
        ORDER BY party_regdate DESC;
	</select>
</mapper>